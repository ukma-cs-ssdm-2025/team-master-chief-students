name: Generate API Docs üìÑ

on:
    push:
        branches:
            - main
            - develop

permissions:
    contents: write

jobs:
    generate-docs:
        runs-on: ubuntu-22.04

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: '20'

            - name: Setup Python
              uses: actions/setup-python@v5
              with:
                  python-version: '3.11'

            - name: Install Python dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install requests

            - name: Run script to generate docs
              run: python scripts/generate_api_docs.py

            - name: Commit and push generated docs
              run: |
                  git config --global user.name 'github-actions[bot]'
                  git config --global user.email 'github-actions[bot]@users.noreply.github.com'
                  git add docs/ # –î–æ–¥–∞—î–º–æ –≤—Å—é –ø–∞–ø–∫—É docs
                  # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î –∑–º—ñ–Ω–∏
                  if git diff --staged --quiet; then
                    echo "‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –∞–∫—Ç—É–∞–ª—å–Ω–∞, –Ω—ñ—á–æ–≥–æ –Ω–µ –∫–æ–º—ñ—Ç–∏–º–æ."
                  else
                    git commit -m "docs: ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é"
                    git push
                    echo "‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é –æ–Ω–æ–≤–ª–µ–Ω–æ —Ç–∞ –∑–∞–ø—É—à–µ–Ω–æ."
                  fi
